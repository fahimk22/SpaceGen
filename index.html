<!DOCTYPE html>
<html>
<head>
  <title>SparkGen AI</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    /* CSS STYLES */
    body { margin: 0; font-family: 'Segoe UI', Arial, sans-serif; display: flex; height: 100vh; background: #f0f0f0; }
    
    /* Sidebar */
    .sidebar { width: 250px; background: #111; color: #fff; display: flex; flex-direction: column; padding: 20px; box-sizing: border-box; }
    .sidebar h2 { margin-top: 0; color: #ff6a00; display: flex; align-items: center; gap: 10px; }
    .sidebar button { 
        width: 100%; margin: 5px 0; padding: 12px; border: none; 
        background: #222; color: #aaa; cursor: pointer; text-align: left;
        border-radius: 8px; transition: 0.2s; font-size: 16px;
    }
    .sidebar button:hover { background: #333; color: #fff; }
    .sidebar button.active { background: #ff6a00; color: #fff; font-weight: bold; }
    
    /* Main Chat Area */
    .main { flex: 1; display: flex; flex-direction: column; background: #fff; }
    .chat { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
    
    /* Messages */
    .msg { padding: 12px 16px; border-radius: 12px; max-width: 75%; line-height: 1.5; word-wrap: break-word; font-size: 15px; animation: fadeIn 0.3s; }
    .user { background: #ff6a00; color: #fff; align-self: flex-end; border-bottom-right-radius: 2px; }
    .bot { background: #f1f5f9; color: #333; align-self: flex-start; border-bottom-left-radius: 2px; border: 1px solid #e2e8f0; }
    
    /* Images inside chat */
    .bot img { max-width: 100%; border-radius: 8px; margin-top: 10px; border: 1px solid #ddd; }
    
    /* Input Area */
    .input-area { display: flex; padding: 20px; border-top: 1px solid #eee; background: #fff; }
    .input-area input { flex: 1; padding: 15px; border: 1px solid #ddd; border-radius: 30px; outline: none; font-size: 16px; transition: 0.3s; }
    .input-area input:focus { border-color: #ff6a00; }
    .input-area button { padding: 0 25px; margin-left: 10px; background: #ff6a00; color: #fff; border: none; border-radius: 30px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.2s; }
    .input-area button:hover { background: #e65c00; }
    .input-area button:disabled { background: #ccc; cursor: not-allowed; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>

<body>

<div class="sidebar">
  <h2>‚ö° SparkGen</h2>
  <button id="btn-chat" onclick="setMode('chat')" class="active">üí¨ Chat</button>
  <button id="btn-image" onclick="setMode('image')">üé® Image</button>
  <button id="btn-video" onclick="setMode('video')">üé• Video</button>
  <button id="btn-search" onclick="setMode('search')">üåê Search</button>
</div>

<div class="main">
  <div class="chat" id="chat">
    </div>
  <div class="input-area">
    <input id="input" placeholder="Type a message..." onkeydown="if(event.key==='Enter') send()">
    <button id="sendBtn" onclick="send()">Send</button>
  </div>
</div>

<script>
// --- CORE LOGIC ---
let mode = "chat";
const chatBox = document.getElementById("chat");
const inputBox = document.getElementById("input");
const sendBtn = document.getElementById("sendBtn");

// Initialize
window.onload = function() {
    bot("Welcome to SparkGen ‚ö°\nI am ready to help. Select a mode on the left.");
    login(); // Simulate login
};

function setMode(m) {
    mode = m;
    
    // UI Updates
    document.querySelectorAll('.sidebar button').forEach(b => b.classList.remove('active'));
    document.getElementById('btn-' + m).classList.add('active');
    
    let msg = "";
    if(m === 'chat') msg = "Switched to Chat Mode. Ask me anything.";
    if(m === 'image') msg = "Switched to Image Mode. Describe what you want to see.";
    if(m === 'video') msg = "Switched to Video Mode. Describe a scene.";
    if(m === 'search') msg = "Switched to Search Mode. I'll find live data for you.";
    
    bot(msg);
    inputBox.placeholder = `Type here for ${m}...`;
    inputBox.focus();
}

// Display User Message
function user(text) {
    add("user", text);
}

// Display Bot Message
function bot(text, isImage = false) {
    add("bot", text, isImage);
}

// Add message to DOM
function add(cls, content, isImage) {
    const d = document.createElement("div");
    d.className = "msg " + cls;
    
    if (isImage) {
        d.innerHTML = `Here is your generated image:<br><img src="${content}" alt="Generated Image">`;
    } else {
        // Simple formatting: newlines to <br>
        d.innerHTML = content.replace(/\n/g, '<br>');
    }
    
    chatBox.appendChild(d);
    chatBox.scrollTop = chatBox.scrollHeight;
}

// Simulate Login
async function login() {
    // In a real app, this would fetch from a server.
    // We simulate it here so the variable exists.
    localStorage.setItem("token", "simulated-token-123");
    console.log("Logged in automatically.");
}

// --- SEND FUNCTION ---
async function send() {
    const text = inputBox.value.trim();
    if (!text) return;

    // 1. Clear input & show user message
    user(text);
    inputBox.value = "";
    
    // 2. Disable button while "thinking"
    sendBtn.disabled = true;
    sendBtn.innerText = "...";

    // 3. Prepare payload (for simulation)
    const body = {
        token: localStorage.getItem("token"),
        message: text,
        mode: mode
    };

    // 4. CALL MOCK BACKEND (Simulating fetch)
    try {
        const data = await mockBackend(body);
        
        // 5. Handle Response
        if (data.reply) bot(data.reply);
        if (data.url) bot(data.url, true); // True flag renders image tag
        if (data.results) bot("üîç <b>Search Results:</b><br>" + data.results.join("<br>‚Ä¢ "));
        
    } catch (e) {
        bot("Error: " + e.message);
    }

    // 6. Re-enable button
    sendBtn.disabled = false;
    sendBtn.innerText = "Send";
    inputBox.focus();
}

// --- MOCK BACKEND (Simulates a server) ---
// This replaces the fetch('http://localhost:3000') calls
function mockBackend(data) {
    return new Promise((resolve) => {
        setTimeout(() => {
            let response = {};

            if (data.mode === 'chat') {
                response.reply = "I understand you said: '" + data.message + "'. As an AI, I can help you elaborate on this topic.";
            } 
            else if (data.mode === 'image') {
                // Returns a random high-quality placeholder image
                const keyword = data.message.split(' ')[0];
                response.url = `https://picsum.photos/seed/${keyword}/400/300`; 
                response.reply = "Generating image based on: " + data.message;
            } 
            else if (data.mode === 'video') {
                response.reply = "üé• <b>Video Prompt Generated:</b><br>Scene: " + data.message + "<br>Style: Cinematic, 4K<br>Camera: Slow Pan<br>(Simulated Video Output)";
            } 
            else if (data.mode === 'search') {
                response.results = [
                    "Latest news about " + data.message,
                    "Wikipedia entry for " + data.message,
                    "Top trending articles relating to " + data.message
                ];
            }

            resolve(response);
        }, 1000); // Simulate 1 second network delay
    });
}
</script>

</body>
</html>
